   Theremin Tone Digitizer

This is an experiment in "quantizing" the notes that are played by a Theremin, in 
particular, by the popular Moog Etherwave from the late 1990s. 

The rationale was that a Theremin is difficult to play because it's hard to hit 
normal notes, since it plays every frequency in between the notes too. So if we 
constrain it to play *only* normal notes, it should be easier to play. 

Well, it doesn't work that way. You might even argue that it makes it worse, since 
errors are a complete note away from what you wanted, which sounds really bad. But it 
was a noble experiment, and maybe someone can figure out a tweak to the 
note-generating algorithm that makes it better. 

Here's how it works: We get a signal which tracks the transitions of the analog 
waveform generated by the Theremin. We determine the transition timing, and from 
that, deduce the waveform period. 

We then find the closest note in either the chromatic (12-tone) or octatonic (8-tone) 
scale, depending on the setting of an option switch. If the note persists for a while 
(50 msec, say, in order to avoid playing unintended notes on the way to a note we 
want), we generate a square wave at that frequency. It is then sent to the 
voltage-controlled amplifier in the Theremin for sound shaping and volume modulation, 
and then on to the speaker. 

This is implemented on a breadboard that has an Arduino Nano, a voltage comparator 
with hysteresis for analyzing the Theremin signal, and a level-shifter to create a 
negative signal for the Theremin from the square wave we output. 

We connect to the Theremin using its 8-pin auxiliary connector, with the unused "AUX" 
pin connected to the input of the voltage-controlled amplifier, and the trace between 
the "AUDIO" output of the detector and the VCA broken so that we can inject our own
signal. 

To honor its history, I built my Theremin inside a 1940s-eras tabletop radio enclosure.

Jun 2009, L. Shustek: first version
Mar 2022, L. Shustek: update for better analog hardware; implement note persistence